<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="764px" preserveAspectRatio="none" style="width:1111px;height:764px;background:#FFFFFF;" version="1.1" viewBox="0 0 1111 764" width="1111px" zoomAndPan="magnify"><title>VocalBridge Ops - Runtime Request &#8594; Provider &#8594; Billing Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="450.4404" x="331.3459" y="28.5352">VocalBridge Ops - Runtime Request &#8594; Provider &#8594; Billing Flow</text><g><title>AI Provider</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="802.9961" y="355.4609"/></g><rect fill="none" height="237.4395" style="stroke:#000000;stroke-width:1.5;" width="684.5879" x="419.5444" y="399.7715"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="564.5449" width="8" x="23.7524" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="27" x2="27" y1="118.9766" y2="683.5215"/></g><g><title>API Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="564.5449" width="8" x="233.9419" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="237.6528" x2="237.6528" y1="118.9766" y2="683.5215"/></g><g><title>Auth . API Key</title><rect fill="#000000" fill-opacity="0.00000" height="564.5449" width="8" x="359.2505" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="362.9565" x2="362.9565" y1="118.9766" y2="683.5215"/></g><g><title>Session Service</title><rect fill="#000000" fill-opacity="0.00000" height="564.5449" width="8" x="483.8994" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="487.5444" x2="487.5444" y1="118.9766" y2="683.5215"/></g><g><title>Agent Router</title><rect fill="#000000" fill-opacity="0.00000" height="564.5449" width="8" x="668.7681" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="672.0439" x2="672.0439" y1="118.9766" y2="683.5215"/></g><g><title>AI Provider</title><rect fill="#000000" fill-opacity="0.00000" height="564.5449" width="8" x="803.9961" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="807.0854" x2="807.0854" y1="118.9766" y2="683.5215"/></g><g><title>Usage.Billing</title><rect fill="#000000" fill-opacity="0.00000" height="564.5449" width="8" x="909.9556" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="913.9067" x2="913.9067" y1="118.9766" y2="683.5215"/></g><g><title>Database</title><rect fill="#000000" fill-opacity="0.00000" height="564.5449" width="8" x="1051.7998" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1055.4673" x2="1055.4673" y1="118.9766" y2="683.5215"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="5" y="116.0234">Client</text><ellipse cx="27.7524" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.7524,58.9883 L27.7524,85.9883 M14.7524,66.9883 L40.7524,66.9883 M27.7524,85.9883 L14.7524,100.9883 M27.7524,85.9883 L40.7524,100.9883" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="5" y="696.0566">Client</text><ellipse cx="27.7524" cy="707.5098" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.7524,715.5098 L27.7524,742.5098 M14.7524,723.5098 L40.7524,723.5098 M27.7524,742.5098 L14.7524,757.5098 M27.7524,742.5098 L40.7524,757.5098" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="API"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.5781" x="189.6528" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.5781" x="196.6528" y="108.0234">API Gateway</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96.5781" x="189.6528" y="682.5215"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.5781" x="196.6528" y="703.0566">API Gateway</text></g><g class="participant participant-head" data-participant="Auth"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112.5879" x="306.9565" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.5879" x="313.9565" y="108.0234">Auth / API Key</text></g><g class="participant participant-tail" data-participant="Auth"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112.5879" x="306.9565" y="682.5215"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.5879" x="313.9565" y="703.0566">Auth / API Key</text></g><g class="participant participant-head" data-participant="Session"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.71" x="429.5444" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.71" x="436.5444" y="108.0234">Session Service</text></g><g class="participant participant-tail" data-participant="Session"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.71" x="429.5444" y="682.5215"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.71" x="436.5444" y="703.0566">Session Service</text></g><g class="participant participant-head" data-participant="Agent"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.4482" x="621.0439" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.4482" x="628.0439" y="108.0234">Agent Router</text></g><g class="participant participant-tail" data-participant="Agent"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.4482" x="621.0439" y="682.5215"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.4482" x="628.0439" y="703.0566">Agent Router</text></g><g class="participant participant-head" data-participant="Provider"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87.8213" x="764.0854" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.8213" x="771.0854" y="108.0234">AI Provider</text></g><g class="participant participant-tail" data-participant="Provider"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="87.8213" x="764.0854" y="682.5215"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.8213" x="771.0854" y="703.0566">AI Provider</text></g><g class="participant participant-head" data-participant="Billing"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104.0977" x="861.9067" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.0977" x="868.9067" y="108.0234">Usage/Billing</text></g><g class="participant participant-tail" data-participant="Billing"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104.0977" x="861.9067" y="682.5215"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.0977" x="868.9067" y="703.0566">Usage/Billing</text></g><g class="participant participant-head" data-participant="DB"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="76.665" x="1017.4673" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.665" x="1024.4673" y="108.0234">Database</text></g><g class="participant participant-tail" data-participant="DB"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="76.665" x="1017.4673" y="682.5215"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.665" x="1024.4673" y="703.0566">Database</text></g><g><title>AI Provider</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="802.9961" y="355.4609"/></g><g class="message" data-participant-1="Client" data-participant-2="API"><polygon fill="#181818" points="225.9419,146.2871,235.9419,150.2871,225.9419,154.2871,229.9419,150.2871" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="231.9419" y1="150.2871" y2="150.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.1895" x="34.7524" y="145.5449">POST /sessions/{id}/message</text></g><g class="message" data-participant-1="API" data-participant-2="Auth"><polygon fill="#181818" points="351.2505,175.5977,361.2505,179.5977,351.2505,183.5977,355.2505,179.5977" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="237.9419" x2="357.2505" y1="179.5977" y2="179.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.3086" x="244.9419" y="174.8555">Validate API Key</text></g><g class="message" data-participant-1="Auth" data-participant-2="API"><polygon fill="#181818" points="248.9419,204.9082,238.9419,208.9082,248.9419,212.9082,244.9419,208.9082" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="242.9419" x2="362.2505" y1="208.9082" y2="208.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97.7412" x="254.9419" y="204.166">Tenant Context</text></g><g class="message" data-participant-1="API" data-participant-2="Session"><polygon fill="#181818" points="475.8994,234.2188,485.8994,238.2188,475.8994,242.2188,479.8994,238.2188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="237.9419" x2="481.8994" y1="238.2188" y2="238.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.5093" x="244.9419" y="233.4766">Load Session + Agent</text></g><g class="message" data-participant-1="Session" data-participant-2="DB"><polygon fill="#181818" points="1043.7998,263.5293,1053.7998,267.5293,1043.7998,271.5293,1047.7998,267.5293" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="487.8994" x2="1049.7998" y1="267.5293" y2="267.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.6982" x="494.8994" y="262.7871">Fetch Session, Agent</text></g><g class="message" data-participant-1="DB" data-participant-2="Session"><polygon fill="#181818" points="498.8994,292.8398,488.8994,296.8398,498.8994,300.8398,494.8994,296.8398" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="492.8994" x2="1054.7998" y1="296.8398" y2="296.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.7837" x="504.8994" y="292.0977">Session, Agent</text></g><g class="message" data-participant-1="Session" data-participant-2="Agent"><polygon fill="#181818" points="660.7681,322.1504,670.7681,326.1504,660.7681,330.1504,664.7681,326.1504" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="487.8994" x2="666.7681" y1="326.1504" y2="326.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.2798" x="494.8994" y="321.4082">Build Prompt + Config</text></g><g class="message" data-participant-1="Agent" data-participant-2="Provider"><polygon fill="#181818" points="790.9961,351.4609,800.9961,355.4609,790.9961,359.4609,794.9961,355.4609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="672.7681" x2="796.9961" y1="355.4609" y2="355.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.3511" x="679.7681" y="350.7188">Call AI Provider</text></g><g class="message" data-participant-1="Provider" data-participant-2="Agent"><polygon fill="#181818" points="683.7681,380.7715,673.7681,384.7715,683.7681,388.7715,679.7681,384.7715" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="677.7681" x2="806.9961" y1="384.7715" y2="384.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.228" x="689.7681" y="380.0293">Response / Error</text></g><path d="M419.5444,399.7715 L481.6831,399.7715 L481.6831,407.082 L471.6831,417.082 L419.5444,417.082 L419.5444,399.7715" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="237.4395" style="stroke:#000000;stroke-width:1.5;" width="684.5879" x="419.5444" y="399.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="434.5444" y="413.3398">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="103.4902" x="496.6831" y="412.4063">[Provider Success]</text><g class="message" data-participant-1="Agent" data-participant-2="DB"><polygon fill="#181818" points="1043.7998,434.3926,1053.7998,438.3926,1043.7998,442.3926,1047.7998,438.3926" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="672.7681" x2="1049.7998" y1="438.3926" y2="438.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.9346" x="679.7681" y="433.6504">Store ProviderCall</text></g><g class="message" data-participant-1="Agent" data-participant-2="Session"><polygon fill="#181818" points="498.8994,463.7031,488.8994,467.7031,498.8994,471.7031,494.8994,467.7031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="492.8994" x2="671.7681" y1="467.7031" y2="467.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.8687" x="504.8994" y="462.9609">Create Assistant Message</text></g><g class="message" data-participant-1="Session" data-participant-2="DB"><polygon fill="#181818" points="1043.7998,493.0137,1053.7998,497.0137,1043.7998,501.0137,1047.7998,497.0137" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="487.8994" x2="1049.7998" y1="497.0137" y2="497.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.9565" x="494.8994" y="492.2715">Persist Message</text></g><g class="message" data-participant-1="Agent" data-participant-2="Billing"><polygon fill="#181818" points="901.9556,522.3242,911.9556,526.3242,901.9556,530.3242,905.9556,526.3242" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="672.7681" x2="907.9556" y1="526.3242" y2="526.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.0635" x="679.7681" y="521.582">Create UsageEvent</text></g><g class="message" data-participant-1="Billing" data-participant-2="DB"><polygon fill="#181818" points="1043.7998,551.6348,1053.7998,555.6348,1043.7998,559.6348,1047.7998,555.6348" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="913.9556" x2="1049.7998" y1="555.6348" y2="555.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.8442" x="920.9556" y="550.8926">Persist UsageEvent</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="419.5444" x2="1104.1323" y1="564.6348" y2="564.6348"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="97.9956" x="424.5444" y="575.2695">[Provider Failure]</text><g class="message" data-participant-1="Agent" data-participant-2="Provider"><polygon fill="#181818" points="795.9961,595.9004,805.9961,599.9004,795.9961,603.9004,799.9961,599.9004" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="672.7681" x2="801.9961" y1="599.9004" y2="599.9004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.7632" x="679.7681" y="595.1582">Retry / Fallback</text></g><g class="message" data-participant-1="Agent" data-participant-2="DB"><polygon fill="#181818" points="1043.7998,625.2109,1053.7998,629.2109,1043.7998,633.2109,1047.7998,629.2109" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="672.7681" x2="1049.7998" y1="629.2109" y2="629.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.1372" x="679.7681" y="624.4688">Store Failed ProviderCall</text></g><g class="message" data-participant-1="API" data-participant-2="Client"><polygon fill="#181818" points="38.7524,661.5215,28.7524,665.5215,38.7524,669.5215,34.7524,665.5215" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="32.7524" x2="236.9419" y1="665.5215" y2="665.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.8877" x="44.7524" y="660.7793">Assistant Response</text></g><!--SRC=[TPF1Rfmm48RlVefHhkcAEuT8PJTRHMsK5QIvEtXAh7Y1sCEcKTLh7w2Fs2VfsDYmq8RJZlVpF_F_3AJ983nqjJI5rQf1kEiTRA0SMj97X19V1dG4VtxzXeFjJbgX3KMXZT5j0tlJlGeXQ-eiR8t6baGlBUbQzx8bkFXuk85Fal1Llbs0TC3r2XZe2J9_3fynCdoqX2fqJdSjL6XFkiP0nRELMiCJGDaDX7RKQluTwMQo4f1KBAclJZQOHPk1Yx-Ns4wIV9Hk76bN236609ihRoc7mrrr3vaRPtNP3wr-PaUkM5nupvvZkpayIACL1vMI426OJTAvnzRtstOjuNSIwMuC8OSldLIfWijeEzKCxeeSzaZrKu8-H6PNX2QJqEhlSurmaaCnQADyQiUUk1MFz4qtOaoUgHHd3bjf39obxTT4dxp7wKHCIxMP6vJeUWuBUIskhUsiKFYVczBGl9BLKDSyg01-facyvueNSxxb9reoa- -jnP0-buvyrBVnBNby5UG1hQScP2aPzsII39jqVV9fUYvzEIkjCmgDcqU6lTHciBZiCOTS8jatJchFrXvb_VnU15u6rJ89R5NS94R7nStF4aZlGVm5]--></g></svg>