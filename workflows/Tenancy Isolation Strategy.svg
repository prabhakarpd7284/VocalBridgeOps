<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="4531px" preserveAspectRatio="none" style="width:1712px;height:4531px;background:#FEFEFE;" version="1.1" viewBox="0 0 1712 4531" width="1712px" zoomAndPan="magnify"><title>Multi-Tenant Isolation - Request Flow</title><defs/><g><rect fill="#FEFEFE" height="4531" style="stroke:none;stroke-width:1;" width="1712" x="0" y="0"/><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="468.1875" x="620.5044" y="37.1182">Multi-Tenant Isolation - Request Flow</text><g><title>Tenant A</title><rect fill="#000000" fill-opacity="0.00000" height="4284.6626" width="8" x="40.5513" y="147.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="44" x2="44" y1="147.7666" y2="4432.4292"/></g><g><title>Tenant B</title><rect fill="#000000" fill-opacity="0.00000" height="4284.6626" width="8" x="119.6675" y="147.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="123.1025" x2="123.1025" y1="147.7666" y2="4432.4292"/></g><g><title>API Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="4284.6626" width="8" x="377.623" y="147.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="381.5742" x2="381.5742" y1="147.7666" y2="4432.4292"/></g><g><title>Auth</title><rect fill="#000000" fill-opacity="0.00000" height="4284.6626" width="8" x="545.7783" y="147.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="549.0547" x2="549.0547" y1="147.7666" y2="4432.4292"/></g><g><title>PostgreSQL</title><rect fill="#000000" fill-opacity="0.00000" height="4284.6626" width="8" x="934.2607" y="147.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="937.6758" x2="937.6758" y1="147.7666" y2="4432.4292"/></g><g><title>Service Layer</title><rect fill="#000000" fill-opacity="0.00000" height="4284.6626" width="8" x="1212.0591" y="147.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1215.375" x2="1215.375" y1="147.7666" y2="4432.4292"/></g><g><title>New Customer</title><rect fill="#000000" fill-opacity="0.00000" height="4284.6626" width="8" x="1491.1626" y="147.7666"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1494.6299" x2="1494.6299" y1="147.7666" y2="4432.4292"/></g><g class="participant participant-head" data-participant="TA"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63.1025" x="10" y="127.8125">Tenant A</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.1748" x="21.4639" y="144.8271">Client</text><ellipse cx="44.5513" cy="61.7373" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M44.5513,69.7373 L44.5513,96.7373 M31.5513,77.7373 L57.5513,77.7373 M44.5513,96.7373 L31.5513,111.7373 M44.5513,96.7373 L57.5513,111.7373" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-participant="TA"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63.1025" x="10" y="4445.5044">Tenant A</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.1748" x="21.4639" y="4462.519">Client</text><ellipse cx="44.5513" cy="4474.4585" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M44.5513,4482.4585 L44.5513,4509.4585 M31.5513,4490.4585 L57.5513,4490.4585 M44.5513,4509.4585 L31.5513,4524.4585 M44.5513,4509.4585 L57.5513,4524.4585" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-head" data-participant="TB"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63.1299" x="89.1025" y="127.8125">Tenant B</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.1748" x="100.5801" y="144.8271">Client</text><ellipse cx="123.6675" cy="61.7373" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M123.6675,69.7373 L123.6675,96.7373 M110.6675,77.7373 L136.6675,77.7373 M123.6675,96.7373 L110.6675,111.7373 M123.6675,96.7373 L136.6675,111.7373" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-participant="TB"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63.1299" x="89.1025" y="4445.5044">Tenant B</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.1748" x="100.5801" y="4462.519">Client</text><ellipse cx="123.6675" cy="4474.4585" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M123.6675,4482.4585 L123.6675,4509.4585 M110.6675,4490.4585 L136.6675,4490.4585 M123.6675,4509.4585 L110.6675,4524.4585 M123.6675,4509.4585 L136.6675,4524.4585" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-head" data-participant="API"><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="104.0977" x="329.5742" y="115.752"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="90.0977" x="336.5742" y="136.8271">API Gateway</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="104.0977" x="329.5742" y="4431.4292"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="90.0977" x="336.5742" y="4452.5044">API Gateway</text></g><g class="participant participant-head" data-participant="AUTH"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="93.4473" x="503.0547" y="98.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="32.8057" x="533.3755" y="119.8125">Auth</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79.4473" x="510.0547" y="136.8271">Middleware</text></g><g class="participant participant-tail" data-participant="AUTH"><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="93.4473" x="503.0547" y="4431.4292"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="32.8057" x="533.3755" y="4452.5044">Auth</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79.4473" x="510.0547" y="4469.519">Middleware</text></g><g class="participant participant-head" data-participant="DB"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="81.1699" x="894.6758" y="144.8271">PostgreSQL</text><path d="M920.2607,94.752 C920.2607,84.752 938.2607,84.752 938.2607,84.752 C938.2607,84.752 956.2607,84.752 956.2607,94.752 L956.2607,120.752 C956.2607,130.752 938.2607,130.752 938.2607,130.752 C938.2607,130.752 920.2607,130.752 920.2607,120.752 L920.2607,94.752" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M920.2607,94.752 C920.2607,104.752 938.2607,104.752 938.2607,104.752 C938.2607,104.752 956.2607,104.752 956.2607,94.752" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-participant="DB"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="81.1699" x="894.6758" y="4445.5044">PostgreSQL</text><path d="M920.2607,4458.4438 C920.2607,4448.4438 938.2607,4448.4438 938.2607,4448.4438 C938.2607,4448.4438 956.2607,4448.4438 956.2607,4458.4438 L956.2607,4484.4438 C956.2607,4494.4438 938.2607,4494.4438 938.2607,4494.4438 C938.2607,4494.4438 920.2607,4494.4438 920.2607,4484.4438 L920.2607,4458.4438" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M920.2607,4458.4438 C920.2607,4468.4438 938.2607,4468.4438 938.2607,4468.4438 C938.2607,4468.4438 956.2607,4468.4438 956.2607,4458.4438" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-head" data-participant="SVC"><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="109.3682" x="1161.375" y="115.752"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="95.3682" x="1168.375" y="136.8271">Service Layer</text></g><g class="participant participant-tail" data-participant="SVC"><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="109.3682" x="1161.375" y="4431.4292"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="95.3682" x="1168.375" y="4452.5044">Service Layer</text></g><g class="participant participant-head" data-participant="NC"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="103.0654" x="1440.6299" y="144.8271">New Customer</text><ellipse cx="1495.1626" cy="78.752" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M1495.1626,86.752 L1495.1626,113.752 M1482.1626,94.752 L1508.1626,94.752 M1495.1626,113.752 L1482.1626,128.752 M1495.1626,113.752 L1508.1626,128.752" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-participant="NC"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="103.0654" x="1440.6299" y="4445.5044">New Customer</text><ellipse cx="1495.1626" cy="4457.4438" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M1495.1626,4465.4438 L1495.1626,4492.4438 M1482.1626,4473.4438 L1508.1626,4473.4438 M1495.1626,4492.4438 L1482.1626,4507.4438 M1495.1626,4492.4438 L1508.1626,4507.4438" fill="none" style="stroke:#000000;stroke-width:1;"/></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1700.1963" x="5" y="178.6663"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="178.6663" y2="178.6663"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="181.6663" y2="181.6663"/><rect fill="#FFFFFF" height="23.7993" style="stroke:#000000;stroke-width:1;" width="197.9805" x="756.1079" y="167.7666"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="179.5371" x="762.1079" y="184.8364">Tenant A Makes Request</text><g class="message" data-participant-1="TA" data-participant-2="API"><polygon fill="#000000" points="369.623,235.1646,379.623,239.1646,369.623,243.1646,373.623,239.1646" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="44.5513" x2="375.623" y1="239.1646" y2="239.1646"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="80.5581" x="51.5513" y="218.6357">GET /agents</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.6479" x="51.5513" y="234.4351">X-API-Key: vb_live_acme_abc123xyz</text></g><g class="message" data-participant-1="API" data-participant-2="AUTH"><polygon fill="#000000" points="537.7783,264.9639,547.7783,268.9639,537.7783,272.9639,541.7783,268.9639" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="381.623" x2="543.7783" y1="268.9639" y2="268.9639"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142.5557" x="388.623" y="264.2344">authenticate(request)</text></g><g class="message" data-participant-1="AUTH" data-participant-2="AUTH"><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="591.7783" y1="314.5625" y2="314.5625"/><line style="stroke:#000000;stroke-width:1;" x1="591.7783" x2="591.7783" y1="314.5625" y2="327.5625"/><line style="stroke:#000000;stroke-width:1;" x1="550.7783" x2="591.7783" y1="327.5625" y2="327.5625"/><polygon fill="#000000" points="560.7783,323.5625,550.7783,327.5625,560.7783,331.5625,556.7783,327.5625" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.7197" x="556.7783" y="294.0337">Extract API key from header</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="243.4517" x="556.7783" y="309.833">apiKey = "vb_live_acme_abc123xyz"</text></g><g class="message" data-participant-1="AUTH" data-participant-2="AUTH"><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="591.7783" y1="373.1611" y2="373.1611"/><line style="stroke:#000000;stroke-width:1;" x1="591.7783" x2="591.7783" y1="373.1611" y2="386.1611"/><line style="stroke:#000000;stroke-width:1;" x1="550.7783" x2="591.7783" y1="386.1611" y2="386.1611"/><polygon fill="#000000" points="560.7783,382.1611,550.7783,386.1611,560.7783,390.1611,556.7783,386.1611" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="87.0454" x="556.7783" y="352.6323">Hash API key</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="199.6021" x="556.7783" y="368.4316">apiKeyHash = sha256(apiKey)</text></g><g class="message" data-participant-1="AUTH" data-participant-2="DB"><polygon fill="#000000" points="926.2607,427.7598,936.2607,431.7598,926.2607,435.7598,930.2607,431.7598" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="932.2607" y1="431.7598" y2="431.7598"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="158.3486" x="556.7783" y="411.231">SELECT * FROM tenants</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156.0381" x="556.7783" y="427.0303">WHERE apiKeyHash = ?</text></g><g class="message" data-participant-1="DB" data-participant-2="AUTH"><polygon fill="#000000" points="560.7783,536.5557,550.7783,540.5557,560.7783,544.5557,556.7783,540.5557" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="554.7783" x2="937.2607" y1="540.5557" y2="540.5557"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="86.7217" x="566.7783" y="456.8296">Tenant found</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="566.7783" y="472.6289">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="157.3457" x="575.9189" y="488.4282">id: "tenant_acme_001",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="134.7925" x="575.9189" y="504.2275">name: "Acme Corp",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="92.2124" x="575.9189" y="520.0269">role: "ADMIN"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="566.7783" y="535.8262">}</text></g><g class="message" data-participant-1="AUTH" data-participant-2="AUTH"><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="591.7783" y1="601.9536" y2="601.9536"/><line style="stroke:#000000;stroke-width:1;" x1="591.7783" x2="591.7783" y1="601.9536" y2="614.9536"/><line style="stroke:#000000;stroke-width:1;" x1="550.7783" x2="591.7783" y1="614.9536" y2="614.9536"/><polygon fill="#000000" points="560.7783,610.9536,550.7783,614.9536,560.7783,618.9536,556.7783,614.9536" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="167.8384" x="556.7783" y="565.6255">Inject tenant into request</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="146.707" x="556.7783" y="581.4248">request.tenant = {...}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="260.0635" x="556.7783" y="597.2241">request.tenantId = "tenant_acme_001"</text></g><g class="message" data-participant-1="AUTH" data-participant-2="API"><polygon fill="#000000" points="392.623,656.5522,382.623,660.5522,392.623,664.5522,388.623,660.5522" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="386.623" x2="548.7783" y1="660.5522" y2="660.5522"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="90.6699" x="398.623" y="640.0234">Authenticated</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="131.4092" x="398.623" y="655.8228">(tenant context set)</text></g><g class="message" data-participant-1="API" data-participant-2="SVC"><polygon fill="#000000" points="1204.0591,686.3516,1214.0591,690.3516,1204.0591,694.3516,1208.0591,690.3516" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="381.623" x2="1210.0591" y1="690.3516" y2="690.3516"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="124.9473" x="388.623" y="685.6221">listAgents(request)</text></g><g class="message" data-participant-1="SVC" data-participant-2="SVC"><line style="stroke:#000000;stroke-width:1;" x1="1216.0591" x2="1258.0591" y1="735.9502" y2="735.9502"/><line style="stroke:#000000;stroke-width:1;" x1="1258.0591" x2="1258.0591" y1="735.9502" y2="748.9502"/><line style="stroke:#000000;stroke-width:1;" x1="1217.0591" x2="1258.0591" y1="748.9502" y2="748.9502"/><polygon fill="#000000" points="1227.0591,744.9502,1217.0591,748.9502,1227.0591,752.9502,1223.0591,748.9502" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="195.73" x="1223.0591" y="715.4214">Extract tenantId from request</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.4087" x="1223.0591" y="731.2207">tenantId = request.tenantId</text></g><g class="message" data-participant-1="SVC" data-participant-2="DB"><polygon fill="#000000" points="949.2607,806.3481,939.2607,810.3481,949.2607,814.3481,945.2607,810.3481" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="943.2607" x2="1215.0591" y1="810.3481" y2="810.3481"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="153.0991" x="955.2607" y="774.02">SELECT * FROM agents</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="253.7983" x="955.2607" y="789.8193">WHERE tenantId = 'tenant_acme_001'</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="129.7461" x="955.2607" y="805.6187">AND isActive = true</text></g><path d="M1221,766.8499 L1221,807.8499 L1512,807.8499 L1512,776.8499 L1502,766.8499 L1221,766.8499" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1502,766.8499 L1502,776.8499 L1512,776.8499 L1502,766.8499" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="270.8608" x="1227" y="784.9197">CRITICAL: tenantId in WHERE clause</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="246.1431" x="1227" y="800.719">This prevents cross-tenant data leaks</text><g class="message" data-participant-1="DB" data-participant-2="SVC"><polygon fill="#000000" points="1204.0591,851.9468,1214.0591,855.9468,1204.0591,859.9468,1208.0591,855.9468" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="938.2607" x2="1210.0591" y1="855.9468" y2="855.9468"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.5967" x="945.2607" y="835.418">Agents for Tenant A</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.438" x="945.2607" y="851.2173">[Agent1, Agent2, Agent3]</text></g><g class="message" data-participant-1="SVC" data-participant-2="API"><polygon fill="#000000" points="392.623,881.7461,382.623,885.7461,392.623,889.7461,388.623,885.7461" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="386.623" x2="1215.0591" y1="885.7461" y2="885.7461"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="62.2896" x="398.623" y="881.0166">Response</text></g><g class="message" data-participant-1="API" data-participant-2="TA"><polygon fill="#000000" points="55.5513,927.3447,45.5513,931.3447,55.5513,935.3447,51.5513,931.3447" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="49.5513" x2="380.623" y1="931.3447" y2="931.3447"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="48.604" x="61.5513" y="910.8159">200 OK</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.438" x="61.5513" y="926.6152">[Agent1, Agent2, Agent3]</text></g><path d="M49,944.3447 L49,985.3447 L194,985.3447 L194,954.3447 L184,944.3447 L49,944.3447" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M184,944.3447 L184,954.3447 L194,954.3447 L184,944.3447" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="124.1475" x="55" y="962.4146">Tenant A sees only</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="109.8779" x="55" y="978.2139">their own agents</text><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1700.1963" x="5" y="1011.843"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="1011.843" y2="1011.843"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="1014.843" y2="1014.843"/><rect fill="#FFFFFF" height="23.7993" style="stroke:#000000;stroke-width:1;" width="310.3213" x="699.9375" y="1000.9434"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="291.8779" x="705.9375" y="1018.0132">Tenant B Attempts Cross-Tenant Access</text><g class="message" data-participant-1="TB" data-participant-2="API"><polygon fill="#000000" points="369.623,1068.3413,379.623,1072.3413,369.623,1076.3413,373.623,1072.3413" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="123.6675" x2="375.623" y1="1072.3413" y2="1072.3413"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="197.1772" x="130.6675" y="1051.8125">GET /agents/agent_acme_xyz</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="233.9556" x="130.6675" y="1067.6118">X-API-Key: vb_live_tech_def456ghi</text></g><path d="M128,1085.3413 L128,1126.3413 L305,1126.3413 L305,1095.3413 L295,1085.3413 L128,1085.3413" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M295,1085.3413 L295,1095.3413 L305,1095.3413 L295,1085.3413" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156.7427" x="134" y="1103.4111">Tenant B tries to access</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="150.8521" x="134" y="1119.2104">Tenant A's agent by ID</text><g class="message" data-participant-1="API" data-participant-2="AUTH"><polygon fill="#000000" points="537.7783,1149.7393,547.7783,1153.7393,537.7783,1157.7393,541.7783,1153.7393" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="381.623" x2="543.7783" y1="1153.7393" y2="1153.7393"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142.5557" x="388.623" y="1149.0098">authenticate(request)</text></g><g class="message" data-participant-1="AUTH" data-participant-2="DB"><polygon fill="#000000" points="926.2607,1195.3379,936.2607,1199.3379,926.2607,1203.3379,930.2607,1199.3379" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="932.2607" y1="1199.3379" y2="1199.3379"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="158.3486" x="556.7783" y="1178.8091">SELECT * FROM tenants</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="364.4824" x="556.7783" y="1194.6084">WHERE apiKeyHash = sha256(vb_live_tech_def456ghi)</text></g><g class="message" data-participant-1="DB" data-participant-2="AUTH"><polygon fill="#000000" points="560.7783,1304.1338,550.7783,1308.1338,560.7783,1312.1338,556.7783,1308.1338" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="554.7783" x2="937.2607" y1="1308.1338" y2="1308.1338"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="86.7217" x="566.7783" y="1224.4077">Tenant found</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="566.7783" y="1240.207">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="150.2427" x="575.9189" y="1256.0063">id: "tenant_tech_002",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="151.8423" x="575.9189" y="1271.8057">name: "TechStart Inc",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="92.2124" x="575.9189" y="1287.605">role: "ADMIN"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="566.7783" y="1303.4043">}</text></g><g class="message" data-participant-1="AUTH" data-participant-2="AUTH"><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="591.7783" y1="1353.7324" y2="1353.7324"/><line style="stroke:#000000;stroke-width:1;" x1="591.7783" x2="591.7783" y1="1353.7324" y2="1366.7324"/><line style="stroke:#000000;stroke-width:1;" x1="550.7783" x2="591.7783" y1="1366.7324" y2="1366.7324"/><polygon fill="#000000" points="560.7783,1362.7324,550.7783,1366.7324,560.7783,1370.7324,556.7783,1366.7324" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="167.8384" x="556.7783" y="1333.2036">Inject tenant into request</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="252.9604" x="556.7783" y="1349.0029">request.tenantId = "tenant_tech_002"</text></g><g class="message" data-participant-1="AUTH" data-participant-2="API"><polygon fill="#000000" points="392.623,1392.5317,382.623,1396.5317,392.623,1400.5317,388.623,1396.5317" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="386.623" x2="548.7783" y1="1396.5317" y2="1396.5317"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="90.6699" x="398.623" y="1391.8022">Authenticated</text></g><g class="message" data-participant-1="API" data-participant-2="SVC"><polygon fill="#000000" points="1204.0591,1422.3311,1214.0591,1426.3311,1204.0591,1430.3311,1208.0591,1426.3311" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="381.623" x2="1210.0591" y1="1426.3311" y2="1426.3311"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179.9814" x="388.623" y="1421.6016">getAgent(agentId, request)</text></g><g class="message" data-participant-1="SVC" data-participant-2="SVC"><line style="stroke:#000000;stroke-width:1;" x1="1216.0591" x2="1258.0591" y1="1487.729" y2="1487.729"/><line style="stroke:#000000;stroke-width:1;" x1="1258.0591" x2="1258.0591" y1="1487.729" y2="1500.729"/><line style="stroke:#000000;stroke-width:1;" x1="1217.0591" x2="1258.0591" y1="1500.729" y2="1500.729"/><polygon fill="#000000" points="1227.0591,1496.729,1217.0591,1500.729,1227.0591,1504.729,1223.0591,1500.729" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="190.5249" x="1223.0591" y="1451.4009">Extract tenantId and agentId</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="198.9736" x="1223.0591" y="1467.2002">tenantId = "tenant_tech_002"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193.0005" x="1223.0591" y="1482.9995">agentId = "agent_acme_xyz"</text></g><g class="message" data-participant-1="SVC" data-participant-2="DB"><polygon fill="#000000" points="949.2607,1558.127,939.2607,1562.127,949.2607,1566.127,945.2607,1562.127" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="943.2607" x2="1215.0591" y1="1562.127" y2="1562.127"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="153.0991" x="955.2607" y="1525.7988">SELECT * FROM agents</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.8174" x="955.2607" y="1541.5981">WHERE id = 'agent_acme_xyz'</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="227.2207" x="955.2607" y="1557.3975">AND tenantId = 'tenant_tech_002'</text></g><path d="M1221,1518.6287 L1221,1559.6287 L1468,1559.6287 L1468,1528.6287 L1458,1518.6287 L1221,1518.6287" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1458,1518.6287 L1458,1528.6287 L1468,1528.6287 L1458,1518.6287" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="226.3384" x="1227" y="1536.6985">Tenant B's tenantId doesn't match</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173.7988" x="1227" y="1552.4978">Agent belongs to Tenant A</text><g class="message" data-participant-1="DB" data-participant-2="SVC"><polygon fill="#000000" points="1204.0591,1587.9263,1214.0591,1591.9263,1204.0591,1595.9263,1208.0591,1591.9263" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="938.2607" x2="1210.0591" y1="1591.9263" y2="1591.9263"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113.8643" x="945.2607" y="1587.1968">No rows returned</text></g><g class="message" data-participant-1="SVC" data-participant-2="API"><polygon fill="#000000" points="392.623,1617.7256,382.623,1621.7256,392.623,1625.7256,388.623,1621.7256" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="386.623" x2="1215.0591" y1="1621.7256" y2="1621.7256"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120.0405" x="398.623" y="1616.9961">NOT_FOUND error</text></g><g class="message" data-participant-1="API" data-participant-2="TB"><polygon fill="#000000" points="134.6675,1742.3208,124.6675,1746.3208,134.6675,1750.3208,130.6675,1746.3208" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="128.6675" x2="380.623" y1="1746.3208" y2="1746.3208"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="96.5859" x="140.6675" y="1646.7954">404 Not Found</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="140.6675" y="1662.5947">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="62.937" x="149.8081" y="1678.394">"error": {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="152.769" x="158.9487" y="1694.1934">"code": "NOT_FOUND",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="197.3994" x="158.9487" y="1709.9927">"message": "Agent not found"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="149.8081" y="1725.792">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="140.6675" y="1741.5913">}</text></g><path d="M128,1759.3208 L128,1800.3208 L322,1800.3208 L322,1769.3208 L312,1759.3208 L128,1759.3208" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M312,1759.3208 L312,1769.3208 L322,1769.3208 L312,1759.3208" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173.5449" x="134" y="1777.3906">Response is 404 (not 403)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.876" x="134" y="1793.1899">to avoid leaking existence</text><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1700.1963" x="5" y="1826.8191"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="1826.8191" y2="1826.8191"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="1829.8191" y2="1829.8191"/><rect fill="#FFFFFF" height="23.7993" style="stroke:#000000;stroke-width:1;" width="132.6313" x="788.7825" y="1815.9194"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114.188" x="794.7825" y="1832.9893">Invalid API Key</text><g class="message" data-participant-1="TA" data-participant-2="API"><polygon fill="#000000" points="369.623,1883.3174,379.623,1887.3174,369.623,1891.3174,373.623,1887.3174" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="44.5513" x2="375.623" y1="1887.3174" y2="1887.3174"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="80.5581" x="51.5513" y="1866.7886">GET /agents</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.3413" x="51.5513" y="1882.5879">X-API-Key: invalid_key_12345</text></g><g class="message" data-participant-1="API" data-participant-2="AUTH"><polygon fill="#000000" points="537.7783,1913.1167,547.7783,1917.1167,537.7783,1921.1167,541.7783,1917.1167" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="381.623" x2="543.7783" y1="1917.1167" y2="1917.1167"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142.5557" x="388.623" y="1912.3872">authenticate(request)</text></g><g class="message" data-participant-1="AUTH" data-participant-2="AUTH"><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="591.7783" y1="1962.7153" y2="1962.7153"/><line style="stroke:#000000;stroke-width:1;" x1="591.7783" x2="591.7783" y1="1962.7153" y2="1975.7153"/><line style="stroke:#000000;stroke-width:1;" x1="550.7783" x2="591.7783" y1="1975.7153" y2="1975.7153"/><polygon fill="#000000" points="560.7783,1971.7153,550.7783,1975.7153,560.7783,1979.7153,556.7783,1975.7153" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="87.0454" x="556.7783" y="1942.1865">Hash API key</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="279.1953" x="556.7783" y="1957.9858">apiKeyHash = sha256(invalid_key_12345)</text></g><g class="message" data-participant-1="AUTH" data-participant-2="DB"><polygon fill="#000000" points="926.2607,2017.314,936.2607,2021.314,926.2607,2025.314,930.2607,2021.314" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="932.2607" y1="2021.314" y2="2021.314"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="158.3486" x="556.7783" y="2000.7852">SELECT * FROM tenants</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156.0381" x="556.7783" y="2016.5845">WHERE apiKeyHash = ?</text></g><g class="message" data-participant-1="DB" data-participant-2="AUTH"><polygon fill="#000000" points="560.7783,2047.1133,550.7783,2051.1133,560.7783,2055.1133,556.7783,2051.1133" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="554.7783" x2="937.2607" y1="2051.1133" y2="2051.1133"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="106.0186" x="566.7783" y="2046.3838">No tenant found</text></g><g class="message" data-participant-1="AUTH" data-participant-2="API"><polygon fill="#000000" points="392.623,2076.9126,382.623,2080.9126,392.623,2084.9126,388.623,2080.9126" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="386.623" x2="548.7783" y1="2080.9126" y2="2080.9126"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="144.1553" x="398.623" y="2076.1831">UNAUTHORIZED error</text></g><g class="message" data-participant-1="API" data-participant-2="TA"><polygon fill="#000000" points="55.5513,2201.5078,45.5513,2205.5078,55.5513,2209.5078,51.5513,2205.5078" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="49.5513" x2="380.623" y1="2205.5078" y2="2205.5078"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="116.1685" x="61.5513" y="2105.9824">401 Unauthorized</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="61.5513" y="2121.7817">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="62.937" x="70.6919" y="2137.5811">"error": {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="176.8838" x="79.8325" y="2153.3804">"code": "UNAUTHORIZED",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="190.8296" x="79.8325" y="2169.1797">"message": "Invalid API key"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="70.6919" y="2184.979">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="61.5513" y="2200.7783">}</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1700.1963" x="5" y="2234.4075"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="2234.4075" y2="2234.4075"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="2237.4075" y2="2237.4075"/><rect fill="#FFFFFF" height="23.7993" style="stroke:#000000;stroke-width:1;" width="136.1479" x="787.0242" y="2223.5078"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="117.7046" x="793.0242" y="2240.5776">Missing API Key</text><g class="message" data-participant-1="TB" data-participant-2="API"><polygon fill="#000000" points="369.623,2290.9058,379.623,2294.9058,369.623,2298.9058,373.623,2294.9058" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="123.6675" x2="375.623" y1="2294.9058" y2="2294.9058"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="80.5581" x="130.6675" y="2274.377">GET /agents</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="149.5889" x="130.6675" y="2290.1763">(no X-API-Key header)</text></g><g class="message" data-participant-1="API" data-participant-2="AUTH"><polygon fill="#000000" points="537.7783,2320.7051,547.7783,2324.7051,537.7783,2328.7051,541.7783,2324.7051" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="381.623" x2="543.7783" y1="2324.7051" y2="2324.7051"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142.5557" x="388.623" y="2319.9756">authenticate(request)</text></g><g class="message" data-participant-1="AUTH" data-participant-2="AUTH"><line style="stroke:#000000;stroke-width:1;" x1="549.7783" x2="591.7783" y1="2354.5044" y2="2354.5044"/><line style="stroke:#000000;stroke-width:1;" x1="591.7783" x2="591.7783" y1="2354.5044" y2="2367.5044"/><line style="stroke:#000000;stroke-width:1;" x1="550.7783" x2="591.7783" y1="2367.5044" y2="2367.5044"/><polygon fill="#000000" points="560.7783,2363.5044,550.7783,2367.5044,560.7783,2371.5044,556.7783,2367.5044" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="144.9614" x="556.7783" y="2349.7749">No API key in headers</text></g><g class="message" data-participant-1="AUTH" data-participant-2="API"><polygon fill="#000000" points="392.623,2393.3037,382.623,2397.3037,392.623,2401.3037,388.623,2397.3037" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="386.623" x2="548.7783" y1="2397.3037" y2="2397.3037"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="144.1553" x="398.623" y="2392.5742">UNAUTHORIZED error</text></g><g class="message" data-participant-1="API" data-participant-2="TB"><polygon fill="#000000" points="134.6675,2517.8989,124.6675,2521.8989,134.6675,2525.8989,130.6675,2521.8989" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="128.6675" x2="380.623" y1="2521.8989" y2="2521.8989"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="116.1685" x="140.6675" y="2422.3735">401 Unauthorized</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="140.6675" y="2438.1729">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="62.937" x="149.8081" y="2453.9722">"error": {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="176.8838" x="158.9487" y="2469.7715">"code": "UNAUTHORIZED",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="194.3589" x="158.9487" y="2485.5708">"message": "Missing API key"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="149.8081" y="2501.3701">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="140.6675" y="2517.1694">}</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1700.1963" x="5" y="2550.7986"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="2550.7986" y2="2550.7986"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="2553.7986" y2="2553.7986"/><rect fill="#FFFFFF" height="23.7993" style="stroke:#000000;stroke-width:1;" width="259.9844" x="725.106" y="2539.8989"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="241.541" x="731.106" y="2556.9688">Tenant Isolation in Service Layer</text><path d="M1008,2578.6982 L1008,3188.6982 L1423,3188.6982 L1423,2588.6982 L1413,2578.6982 L1008,2578.6982" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1413,2578.6982 L1413,2588.6982 L1423,2588.6982 L1413,2578.6982" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162.5571" x="1014" y="2596.7681">Service Layer Pattern:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="1014" y="2612.5674">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="227.3032" x="1014" y="2628.3667">All queries MUST include tenantId:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="1014" y="2644.166">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="89.3369" x="1014" y="2659.9653">```typescript</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.6431" x="1014" y="2675.7646">// &#9989; CORRECT</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="291.1606" x="1014" y="2691.564">async function listAgents(tenantId: string) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="209.187" x="1023.1406" y="2707.3633">return prisma.agent.findMany({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="131.8408" x="1032.2813" y="2723.1626">where: { tenantId }</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="20.0586" x="1023.1406" y="2738.9619">});</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="1014" y="2754.7612">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="1014" y="2770.5605">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="213.2759" x="1014" y="2786.3599">// &#10060; WRONG - Missing tenantId</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="187.5288" x="1014" y="2802.1592">async function listAgents() {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="212.7417" x="1023.1406" y="2817.9585">return prisma.agent.findMany();</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="1014" y="2833.7578">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="1014" y="2849.5571">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.8887" x="1014" y="2865.3564">// &#9989; CORRECT - Get specific resource</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="394.0054" x="1014" y="2881.1558">async function getAgent(tenantId: string, agentId: string) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="202.9854" x="1023.1406" y="2896.9551">return prisma.agent.findFirst({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="213.8525" x="1032.2813" y="2912.7544">where: { id: agentId, tenantId }</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="20.0586" x="1023.1406" y="2928.5537">});</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="1014" y="2944.353">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="1014" y="2960.1523">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="229.6465" x="1014" y="2975.9517">// &#10060; WRONG - Only filtering by ID</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="281.0742" x="1014" y="2991.751">async function getAgent(agentId: string) {</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="202.9854" x="1023.1406" y="3007.5503">return prisma.agent.findFirst({</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.7319" x="1032.2813" y="3023.3496">where: { id: agentId }</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="20.0586" x="1023.1406" y="3039.1489">});</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="1014" y="3054.9482">}</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="24.7939" x="1014" y="3070.7476">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="1014" y="3086.5469">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108.4561" x="1014" y="3102.3462">Key Principles:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="264.0562" x="1014" y="3118.1455">1. tenantId injected by auth middleware</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="329.145" x="1014" y="3133.9448">2. All service methods require tenantId parameter</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="311.5239" x="1014" y="3149.7441">3. All queries include tenantId in WHERE clause</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="302.2056" x="1014" y="3165.5435">4. Return 404 (not 403) for missing resources</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="254.395" x="1014" y="3181.3428">5. No admin endpoints bypass tenancy</text><path d="M695,3199.0723 L695,3651.0723 L1180,3651.0723 L1180,3209.0723 L1170,3199.0723 L695,3199.0723" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1170,3199.0723 L1170,3209.0723 L1180,3209.0723 L1170,3199.0723" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="181.708" x="701" y="3217.1421">Database-Level Defense:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="701" y="3232.9414">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="226.6431" x="701" y="3248.7407">Row-Level Security (Optional):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="43.2339" x="701" y="3264.54">```sql</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="349.1021" x="701" y="3280.3394">ALTER TABLE agents ENABLE ROW LEVEL SECURITY;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="701" y="3296.1387">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="286.2476" x="701" y="3311.938">CREATE POLICY tenant_isolation ON agents</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="406.8276" x="710.1406" y="3327.7373">USING (tenantId = current_setting('app.current_tenant_id'));</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="24.7939" x="701" y="3343.5366">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="701" y="3359.3359">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="187.5986" x="701" y="3375.1353">Indexes for Performance:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="43.2339" x="701" y="3390.9346">```sql</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="371.249" x="701" y="3406.7339">CREATE INDEX idx_agents_tenant ON agents(tenantId);</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="392.7422" x="701" y="3422.5332">CREATE INDEX idx_sessions_tenant ON sessions(tenantId);</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="464.1406" x="701" y="3438.3325">CREATE INDEX idx_usage_events_tenant ON usage_events(tenantId);</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="24.7939" x="701" y="3454.1318">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="701" y="3469.9312">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="145.6089" x="701" y="3485.7305">Composite Indexes:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="43.2339" x="701" y="3501.5298">```sql</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="271.8193" x="701" y="3517.3291">CREATE INDEX idx_agents_tenant_active</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.2588" x="710.1406" y="3533.1284">ON agents(tenantId, isActive);</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="701" y="3548.9277">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="304.5796" x="701" y="3564.7271">CREATE INDEX idx_sessions_tenant_customer</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="236.1709" x="710.1406" y="3580.5264">ON sessions(tenantId, customerId);</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="24.7939" x="701" y="3596.3257">```</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.5703" x="701" y="3612.125">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="274.0981" x="701" y="3627.9243">All primary queries filter by tenantId first,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="240.354" x="701" y="3643.7236">using these indexes for fast lookups.</text><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1700.1963" x="5" y="3677.3528"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="3677.3528" y2="3677.3528"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1705.1963" y1="3680.3528" y2="3680.3528"/><rect fill="#FFFFFF" height="23.7993" style="stroke:#000000;stroke-width:1;" width="244.877" x="732.6597" y="3666.4531"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="226.4336" x="738.6597" y="3683.5229">Tenant Creation (Special Case)</text><g class="message" data-participant-1="NC" data-participant-2="API"><polygon fill="#000000" points="392.623,3781.249,382.623,3785.249,392.623,3789.249,388.623,3785.249" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="386.623" x2="1494.1626" y1="3785.249" y2="3785.249"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="94.4658" x="398.623" y="3717.3223">POST /tenants</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="398.623" y="3733.1216">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.6094" x="407.7637" y="3748.9209">"name": "New Company",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196.3267" x="407.7637" y="3764.7202">"email": "admin@newco.com"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="398.623" y="3780.5195">}</text></g><path d="M1500,3718.0518 L1500,3775.0518 L1695,3775.0518 L1695,3728.0518 L1685,3718.0518 L1500,3718.0518" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1685,3718.0518 L1685,3728.0518 L1695,3728.0518 L1685,3718.0518" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="174.0337" x="1506" y="3736.1216">Only endpoint that doesn't</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="144.479" x="1506" y="3751.9209">require authentication</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.603" x="1506" y="3767.7202">(creates the first API key)</text><g class="message" data-participant-1="API" data-participant-2="SVC"><polygon fill="#000000" points="1204.0591,3811.0483,1214.0591,3815.0483,1204.0591,3819.0483,1208.0591,3815.0483" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="381.623" x2="1210.0591" y1="3815.0483" y2="3815.0483"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.9268" x="388.623" y="3810.3188">createTenant(input)</text></g><g class="message" data-participant-1="SVC" data-participant-2="SVC"><line style="stroke:#000000;stroke-width:1;" x1="1216.0591" x2="1258.0591" y1="3860.647" y2="3860.647"/><line style="stroke:#000000;stroke-width:1;" x1="1258.0591" x2="1258.0591" y1="3860.647" y2="3873.647"/><line style="stroke:#000000;stroke-width:1;" x1="1217.0591" x2="1258.0591" y1="3873.647" y2="3873.647"/><polygon fill="#000000" points="1227.0591,3869.647,1217.0591,3873.647,1227.0591,3877.647,1223.0591,3873.647" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="163.1475" x="1223.0591" y="3840.1182">Generate unique API key</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="265.1035" x="1223.0591" y="3855.9175">apiKey = "vb_live_" + randomBytes(32)</text></g><g class="message" data-participant-1="SVC" data-participant-2="SVC"><line style="stroke:#000000;stroke-width:1;" x1="1216.0591" x2="1258.0591" y1="3919.2456" y2="3919.2456"/><line style="stroke:#000000;stroke-width:1;" x1="1258.0591" x2="1258.0591" y1="3919.2456" y2="3932.2456"/><line style="stroke:#000000;stroke-width:1;" x1="1217.0591" x2="1258.0591" y1="3932.2456" y2="3932.2456"/><polygon fill="#000000" points="1227.0591,3928.2456,1217.0591,3932.2456,1227.0591,3936.2456,1223.0591,3932.2456" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="87.0454" x="1223.0591" y="3898.7168">Hash API key</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="199.6021" x="1223.0591" y="3914.5161">apiKeyHash = sha256(apiKey)</text></g><g class="message" data-participant-1="SVC" data-participant-2="SVC"><line style="stroke:#000000;stroke-width:1;" x1="1216.0591" x2="1258.0591" y1="3977.8442" y2="3977.8442"/><line style="stroke:#000000;stroke-width:1;" x1="1258.0591" x2="1258.0591" y1="3977.8442" y2="3990.8442"/><line style="stroke:#000000;stroke-width:1;" x1="1217.0591" x2="1258.0591" y1="3990.8442" y2="3990.8442"/><polygon fill="#000000" points="1227.0591,3986.8442,1217.0591,3990.8442,1227.0591,3994.8442,1223.0591,3990.8442" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="88.0801" x="1223.0591" y="3957.3154">Extract prefix</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="223.6343" x="1223.0591" y="3973.1147">apiKeyPrefix = apiKey.slice(0, 16)</text></g><g class="message" data-participant-1="SVC" data-participant-2="DB"><polygon fill="#000000" points="949.2607,4048.2422,939.2607,4052.2422,949.2607,4056.2422,945.2607,4052.2422" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="943.2607" x2="1215.0591" y1="4052.2422" y2="4052.2422"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="140.9561" x="955.2607" y="4015.9141">INSERT INTO tenants</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="177.4805" x="955.2607" y="4031.7134">(name, email, apiKeyHash,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="183.3457" x="955.2607" y="4047.5127">apiKeyPrefix, role: 'ADMIN')</text></g><g class="message" data-participant-1="DB" data-participant-2="SVC"><polygon fill="#000000" points="1204.0591,4157.0381,1214.0591,4161.0381,1204.0591,4165.0381,1208.0591,4161.0381" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="938.2607" x2="1210.0591" y1="4161.0381" y2="4161.0381"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="98.5474" x="945.2607" y="4077.312">Tenant created</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="945.2607" y="4093.1113">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="163.6489" x="954.4014" y="4108.9106">id: "tenant_newco_003",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="157.6758" x="954.4014" y="4124.71">name: "New Company",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="92.2124" x="954.4014" y="4140.5093">role: "ADMIN"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="945.2607" y="4156.3086">}</text></g><g class="message" data-participant-1="SVC" data-participant-2="API"><polygon fill="#000000" points="392.623,4202.6367,382.623,4206.6367,392.623,4210.6367,388.623,4206.6367" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="386.623" x2="1215.0591" y1="4206.6367" y2="4206.6367"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="114.8164" x="398.623" y="4186.1079">Tenant + API key</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="191.5342" x="398.623" y="4201.9072">(plain text, only shown once)</text></g><g class="message" data-participant-1="API" data-participant-2="NC"><polygon fill="#000000" points="1483.1626,4343.0313,1493.1626,4347.0313,1483.1626,4351.0313,1487.1626,4347.0313" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="381.623" x2="1489.1626" y1="4347.0313" y2="4347.0313"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="80.5073" x="388.623" y="4231.7065">201 Created</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="388.623" y="4247.5059">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="175.5825" x="397.7637" y="4263.3052">"id": "tenant_newco_003",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.6094" x="397.7637" y="4279.1045">"name": "New Company",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="152.0708" x="397.7637" y="4294.9038">"apiKey": "vb_live_...",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="174.8462" x="397.7637" y="4310.7031">"apiKeyPrefix": "vb_live_",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.146" x="397.7637" y="4326.5024">"role": "ADMIN"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.252" x="388.623" y="4342.3018">}</text></g><path d="M1500,4360.0313 L1500,4417.0313 L1684,4417.0313 L1684,4370.0313 L1674,4360.0313 L1500,4360.0313" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1674,4360.0313 L1674,4370.0313 L1684,4370.0313 L1674,4360.0313" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="163.376" x="1506" y="4378.1011">API key shown only once</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2114" x="1506" y="4393.9004">Customer must save it</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.5352" x="1506" y="4409.6997">Plain text never stored</text><!--SRC=[hLZDSkEu4RxZAJhCmP9MrlXlvg0j9v5asQDQMN8aUMStSKe3av25c0Iv06HRE-LZRdc4vENo96a094LIygozDJLL8nD0Dxhxwr_yGIzPn209AHT4tNEHK4aZkAN-_PsCLoBenM4iuO_dVVEF4CrroE1o5Mg-FsE22Wq35OTKyrZ0FapOBokcD9o7yICXrDT8wwNdEZUY5t8cj0TKmQnJsUwMjxi49T7SvudPz3fN0xYWcZtIjTt7xyg1bLxUY4iU124UaioTkfvz907Lz9Og1jvLhFITPDE_3ktkMUMEAPCFt6Smf6icxOdfZpr2JayXqm0kwJrJkPQdfuJCEh3_9oDE6oxwCtX7xr05TID-siUr_H_OkWqFj_EGFx0vzIFyxzO_F3f-MlzAYD79qAAGRQ0eFr9o7vMiINT17S_WvkPG_qbBj9gv3kxP6XOoZc39QC3aZQ09n-lW5BpT5tfLRX-fMcQiCdAxTWfgIO_UVwYvjO8OPzqsJFl3Vcy63JYVZ2z1MzEWmfy-zYTzA77vCo5dNTZFBqpDk31-TIE-t0W07hJ1SpoSk0S7XrxJx0WQCTphu2BqOfcuLHc7TlNiSZ3oRiHpLQU1-2T30pcEm8ME8JNcZKZ_QAMRf_2brMezLzS7WJ5XLQJidWphJW4krAMMylHZeTcJ1iKiU0vWzA8sX5pfZlMD0hguan_8iCsbiE3cmXU4gygRyzb69_D61qw1nrv5mRqRqHcT0LSTNwFhu0ajLumG4Mi6ajyjDMaqUfF1RD3h3DiRJbo0u-s7TALOeq5cIwuWaUp1t0o-Z9NQJwrZ8X52HkyLOI80mplt46i3Po1q40cRfF5tkthOTBj7wU_nFrArCqGcJ2MnK2mrEoxFEcquEZY0yGzVOxBH4EA5IKjvi2k6iHwBS4qGQouXVXIfGGlYRx935pfQioX11NfMwuoHxpEbNBBexaeMxiT1WN6wCtTevY_d0LkSlFzmj-HRKdT9BeIM7CL6lwVstboTFUM4Xzir3CuA6hmb3Rqj_jCiibk7-jkIWoK-E3Wg9OSPBaurvd2CU_zR9uXI8iYl_seYA8Vy7NCHNxDs7mHDU6NaKyGcfIa5_fOmcBNTCRDPzYBlrLc1stnGfaxJmOw4aTszLyeDcVUXa-KqGSoKsDCGKUqlISVv7WjZSMVTC_FB5rB127697nMQJA-aO44bsaVZsVnyV8qoCYbZMGXwrFRau0JfiGif-99dptbji5_uxSS1mqylv-Jy1tSY31iqXzbqKgDqpYyzS-BPUjLM06Rv1tEe5Q1cg4uEZkl4nE93Z6OsgO-BEs1FM0oOy5avZmp40mtnc575LlBNjHVSaSsnYi-nqf-y_psTnM_t0blNVBEs0A7MXU2lHjZro7oF9uE_zRVHxXYq3-5Q62rZoNzblmbuaTykp8imeB85p16ZIwwKWR24KNStHkW1aEEKjcdrtmCE6YZh-B3UEaRgJMRgVdip5IsnPQQjqG3bBhNNrd0sXk87_3ADTgDHFd55iPnAqSQUWdJ24D0sjhHTNazdoCyFLm7BiqsRaC-VF-jrmfGlUQB9ktVml__y2thZoGJTab2r5ZuiLiAtuXIwiPm3A2oTuguENmYaQGVx6AuYshA8jXPS19TKh6lc0C3ZaaaiDLys6UyPrv_htnEqWRd-l_-6JvFnw0BdeinOUSlsiZolk7zpnKP3lEI2OUEPC9ylk8yCLBoIc68gD-L5gQftCoivhpF4EPTALorX2dPUx5vXbZ4sLx3W8U9ihECwavS4_gRY5OH2lo7eV2P6hv0nJeCXKyRh3bl5FjUq3ImmCfeOWYYVDCbH2un_gjHx8uOX5YXRxBdSk2ZOqPgXhkJOKMGUNNNcQbTDJbhOtbf5IvN5DifHwbePu8gyRvcCGOC8sM21IM9kckhRTK9LMfxzTQ7oRA8G1-96uomTb_U7sCA7SCOM3AkQZS96On8_fkjJvgyarskeZHE34mthvWmQK_qIaivmrfzWTkuE-sct0VsH_PgCFy6m_sD_Y0MZTuq3nS_V4zARz3kpFboDXuFUpwaPvZnF7kDHrdS3N4y7w3grGcU2SaZJk-3CfT4GjJsQ9AriCUCLxDKHx1JgWGZO4tDpnXMJ-1EXJLX1_bIWmUYi_nEwpTFStP-osmYKou7CjsWK9aiKlqYLBNsLRcLIxDmDK0NQudAHFbMg5qT9h3XYcQhtQdMmwpCp7nftMwzcFXBMDpYzgEBSNoaTH-ZXi5FR9cG7DfARGC3mZQXSvm7XKeA9jSqqR0AwILOkZIwPQRGAC2weqX36yVqgKQsTurbFCkTDjQd9aJI47dfvtHQYz2Lgn1wXbmfettz6FK96lRowNusnyhpBMnjNFyqeOlj8GumOO89svT9Z4UMXsRAX-1V17lsuvSUHLsaWYKs3MQIYSbHdpJF9aaYXJq0TICqtsfWvRycSQR8wND-Ux6m_xGYSBR2NIrRLAUI22IRn2Am4HnogpM3nNSc3xq3Ya197tJKAKJi-gl1wmylIha4eaMp1dpB2A_k5fEwpfKBCihM39Xn-g9U6dC5esf_Cy6SstlIVDODF4omMpK8VsYopRwQ3uvuT7FVgvM4aTI5dmrtJgSKMnwBZqdYwvHBRmsbfg4cl-MvZkffzc0NpfjIqJn5eF_CC4MEwgc_wkr7Fl7GSEX_Vj7Oyy5uKyIj-w-nYzZB0MwrMQS_Ph7WYtJOAUcKDouCIHbJMocQQe5967P957aJu1oZwW16koLLk013C52ay974SpBty_m00]--></g></svg>